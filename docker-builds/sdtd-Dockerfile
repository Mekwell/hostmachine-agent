FROM debian:bookworm-slim
RUN apt-get update && apt-get install -y lib32gcc-s1 curl ca-certificates nodejs npm && rm -rf /var/lib/apt/lists/*
RUN useradd -m steam
RUN mkdir -p /home/steam/steamcmd /data /home/steam/.steam/sdk64 && \
    chown -R steam:steam /home/steam /data
WORKDIR /home/steam
USER steam
RUN cd /home/steam/steamcmd && curl -sL https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz | tar -xvz
WORKDIR /data
EXPOSE 26900/tcp 26900/udp 26901/udp 26902/udp
COPY --chmod=755 sdtd-entrypoint.sh /entrypoint.sh
COPY runner.js /runner.js
USER steam
ENV GAME_COMMAND="bash /entrypoint.sh"
LABEL hostmachine.runner="true"
ENTRYPOINT ["node", "/runner.js"]
