FROM debian:bookworm-slim
RUN apt-get update && apt-get install -y lib32gcc-s1 curl ca-certificates nodejs npm libsdl2-2.0-0 && rm -rf /var/lib/apt/lists/*
RUN useradd -m steam
RUN mkdir -p /home/steam/steamcmd /data /home/steam/.steam/sdk64 && \
    chown -R steam:steam /home/steam /data
WORKDIR /home/steam
USER steam
RUN cd /home/steam/steamcmd && curl -sL https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz | tar -xvz
WORKDIR /data
EXPOSE 7777/udp 7778/udp 27015/udp
COPY ark-evolved-entrypoint.sh /entrypoint.sh
COPY runner.js /runner.js
USER root
RUN chmod +x /entrypoint.sh
USER steam
ENV GAME_COMMAND="/bin/bash /entrypoint.sh"
LABEL hostmachine.runner="true"
ENTRYPOINT ["node", "/runner.js"]
