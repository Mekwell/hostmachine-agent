# Escape character for Dockerfile
# escape=`

# Use Windows Server Core as the base image
FROM mcr.microsoft.com/windows/servercore:ltsc2022

# Set shell to powershell
SHELL ["powershell", "-Command", "$ErrorActionPreference = 'Stop'; $ProgressPreference = 'SilentlyContinue';"]

# Install SteamCMD
WORKDIR C:\steamcmd
RUN Invoke-WebRequest -Uri https://steamcdn-a.akamaihd.net/client/installer/steamcmd_win32.zip -OutFile steamcmd.zip; `
    Expand-Archive -Path steamcmd.zip -DestinationPath C:\steamcmd; `
    Remove-Item steamcmd.zip

# Create data directory
RUN New-Item -Path C:\data -ItemType Directory

# Set working directory to data
WORKDIR C:\data

# Copy entrypoint script
COPY ark-ascended-windows-entrypoint.ps1 C:\entrypoint.ps1

# Default environment variables
ENV SERVER_NAME="HostMachine ASA Windows" `
    ADMIN_PASSWORD="admin123" `
    MAX_PLAYERS=70 `
    MAP="TheIsland_WP"

# Run entrypoint
ENTRYPOINT ["powershell", "C:\entrypoint.ps1"]